<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Room Check-In Status</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      max-width: 700px;
      margin-top: 20px;
    }
    th, td {
      padding: 8px 12px;
      border: 1px solid #ccc;
      text-align: left;
    }
    .status-ok {
      background-color: #d4edda;
      color: #155724;
      font-weight: bold;
    }
    .status-missing {
      background-color: #f8d7da;
      color: #721c24;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2>Room Check-Ins This Week</h2>
  <table id="status-table">
    <thead>
      <tr><th>Room</th><th>Status</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const apiKey = '5b9a10e2092947d49dac84004ad149a2';
    const formId = '250955404825056';
    
    // Replace 'YOUR_ROOM_FIELD_ID' with your actual Jotform room field ID.
    // You need to find this in your Jotform form (likely a number like '3', '5', etc.).
    // You can check the JSON of a submission or Jotform form builder.
    const roomFieldId = 'space'; 

    // Your full static room list
    const allRooms = [
      "Room 100", "Room 102", "Room 103", "Room 104", "Room 108-110", "Room 111", "Room 112", "Room 113", 
      "Kitchen", "Room 118", "Bathroom 118", "Room 120", "Bathroom 92-1-1", "Bathroom 92-1-2", "Hallway 92-1", 
      "Entrance E", "Stairwell E", "Stairwell B", "Hallway 92-2", "Worship Center", "Bathroom 92-2-1", "Bathroom 92-2-2", 
      "Hallway 92-3", "Bathroom 92-3-1", "Bathroom 92-3-2", "Worship Center Balcony", "Stairwell C", "Stairwell D", 
      "Hallway 72-1", "Bathroom 72-1-1", "Bathroom 72-1-2", "Room 124", "Room 127", "Room 130", "Stairwell F", 
      "Entrance F", "Hallway 72-2", "Bathroom 72-2-1", "Bathroom 72-2-2", "Room Zone", "Bathroom Zone", "Kitchen 72-2", 
      "Entrance A", "Room 220", "Hallway 72-3", "Bathroom 72-3-1", "Bathroom 72-3-2", "Room 320", "Room 323", "Room 326", 
      "Room 328", "Room 330", "Room Office", "Hallway 25-1", "Bathroom 25-1-1", "Bathroom 25-1-2", "Kitchen Office", 
      "Room Conf", "Room Meet 1", "Room Meet 2", "Room Meet 3", "Stairwell G", "Gym", "Hallway 25-2", "Bathroom 25-2-1", 
      "Bathroom 25-2-2", "Room 250", "Room 254", "Gym Balcony"
    ];

    // Calculate date for 7 days ago
    const oneWeekAgo = new Date();
    oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);

    fetch(`https://api.jotform.com/form/${formId}/submissions?apiKey=${apiKey}`)
      .then(res => res.json())
      .then(data => {
        if (!data.content) {
          throw new Error('No submissions found.');
        }

        const submissions = data.content;
        const recentRooms = new Set();

        submissions.forEach(sub => {
          const submittedAt = new Date(sub.created_at);
          if (submittedAt >= oneWeekAgo) {
            const roomName = sub.answers[roomFieldId]?.answer?.trim();
            if (roomName) {
              recentRooms.add(roomName);
            }
          }
        });

        const tbody = document.querySelector("#status-table tbody");
        tbody.innerHTML = ''; // clear existing rows

        allRooms.forEach(room => {
          const hasTurnedIn = recentRooms.has(room);
          const statusText = hasTurnedIn ? "✅ Turned In" : "❌ Missing";
          const statusClass = hasTurnedIn ? "status-ok" : "status-missing";

          const row = `
            <tr>
              <td>${room}</td>
              <td class="${statusClass}">${statusText}</td>
            </tr>
          `;
          tbody.insertAdjacentHTML('beforeend', row);
        });
      })
      .catch(err => {
        console.error('Error fetching Jotform data:', err);
        document.body.insertAdjacentHTML('beforeend', '<p style="color:red;">Error loading submissions. Check console.</p>');
      });
  </script>
</body>
</html>
